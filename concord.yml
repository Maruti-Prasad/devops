configuration:
  dependencies:
  - "mvn://org.codehaus.groovy:groovy-all:pom:2.5.23"
  - "mvn://org.python:jython-standalone:2.7.4"
  - "mvn://org.jruby:jruby:9.1.17.0"
  - "mvn://com.walmartlabs.concord.plugins.basic:ansible-tasks:2.14.0"


  runtime: "concord-v2"
  arguments:
    saDCSlinuxSVC: ["saDCSlinuxSVC_test", "sadcslinuxsvc_pass_test", "saDCSlinuxSVC_user_test", "looper_http_api_token_test","osp_ad_svc_password_test"]
    SVCWindowsCM: ["svcWindowsCM_test", "svcWindowsCM_password_test"]
    SVC_Puppeteer: ["svc_pass_test"]
    SVCpuptlmtd: ["svcpuptlmtd_test"]
forms:
  Concord:
  - selectedService:
      label: "Select Secret Group"
      type: "string"
      allow: ["saDCSlinuxSVC", "SVCWindowsCM","SVC_Puppeteer","SVCpuptlmtd"]
  - Password: { label: "Password", type: "string", inputType: "password" }  

flows:
  default:
  - form: Concord
  - set:
      date: "${datetime.format(datetime.current(), 'dd_MM_yyyy')}"
      service: "${Concord.selectedService}"
      WM_Config: |
        ansible_port: 5985
        ansible_user: "${Concord.selectedService}"
        ansible_password: "${Concord.Password}"
        ansible_connection: winrm
        ansible_winrm_server_cert_validation: ignore
        ansible_winrm_transport: ntlm
        ansible_winrm_operation_timeout_sec: 120
        ansible_winrm_read_timeout_sec: 130
        ansible_winrm_message_encryption: auto

  - form: ApprovalForm
    fields:
      - approval: { label: "<span style='color: #ff6b35;'>‚≠ê Approve this request</span> Approve password update for: ", type: boolean}

  - task: concordSecrets
    in:
      action: update
      ignoreErrors: false
      name: "test12"
      visibility: "PRIVATE"
      data: "${WM_Config}"
  - task: concordSecrets
    in:
      action: getAsString
      name: "test12"
      ignoreErrors: false
    out: result
  - log: "Validate Result: ${result}"

